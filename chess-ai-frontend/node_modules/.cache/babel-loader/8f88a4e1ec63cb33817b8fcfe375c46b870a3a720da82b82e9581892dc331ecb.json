{"ast":null,"code":"var _jsxFileName = \"/Users/bignola/Desktop/School/Capstone/AI-Chess-main/chess-ai-frontend/src/components/ChessBoard/ChessBoard.jsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useCallback, useRef } from 'react';\nimport { Chessboard } from 'react-chessboard';\nimport { Chess } from 'chess.js';\nimport './ChessBoard.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst ChessBoard = ({\n  onGameEnd\n}) => {\n  _s();\n  const [game, setGame] = useState(() => new Chess());\n  const [boardOrientation, setBoardOrientation] = useState('white');\n  const [isAIThinking, setIsAIThinking] = useState(false);\n  const [moveHistory, setMoveHistory] = useState([]);\n  const [playerColor, setPlayerColor] = useState('white');\n  const [selectedSquare, setSelectedSquare] = useState(null);\n  const [legalMoveSquares, setLegalMoveSquares] = useState({});\n  // Add states for promotion handling\n  const [pendingPromotion, setPendingPromotion] = useState(null);\n  const [promotionVisible, setPromotionVisible] = useState(false);\n  // Use a ref to track the current game state for async operations\n  const gameRef = useRef(new Chess());\n\n  // Update the ref whenever game state changes\n  useEffect(() => {\n    gameRef.current = new Chess(game.fen());\n  }, [game]);\n  function showLegalMoves(sourceSquare) {\n    if (!sourceSquare) return [];\n    const legalMoves = game.moves({\n      square: sourceSquare,\n      verbose: true\n    });\n    console.log(`Legal moves from ${sourceSquare}:`, legalMoves);\n    return legalMoves;\n  }\n\n  // Make AI move - wrapped in useCallback to fix dependency warning\n  const makeAIMove = useCallback(async () => {\n    if (isAIThinking) {\n      console.log(\"AI is already thinking, skipping move request\");\n      return;\n    }\n    setIsAIThinking(true);\n    console.log(\"AI is thinking...\");\n    try {\n      // Use the gameRef to get the current state\n      const currentFEN = gameRef.current.fen();\n      console.log(\"Current FEN for AI move:\", currentFEN);\n      const response = await fetch('http://localhost:8000/chess/get-move', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          fen: currentFEN\n        })\n      });\n      if (!response.ok) {\n        const errorText = await response.text();\n        throw new Error(`Server responded with ${response.status}: ${errorText}`);\n      }\n      const data = await response.json();\n      console.log(\"AI selected move:\", data.move);\n      if (!data.move || !data.move.from || !data.move.to) {\n        throw new Error(\"Invalid move data received from AI: \" + JSON.stringify(data));\n      }\n\n      // Use the gameRef to make the AI move\n      const gameCopy = new Chess(currentFEN);\n      try {\n        const moveObj = {\n          from: data.move.from,\n          to: data.move.to,\n          promotion: data.move.promotion || 'q' // Default to queen if not specified\n        };\n        console.log(\"AI move being applied:\", moveObj);\n        const result = gameCopy.move(moveObj);\n        if (!result) {\n          throw new Error(\"Failed to apply AI move: \" + JSON.stringify(moveObj));\n        }\n        console.log(\"AI move successfully applied:\", result);\n        console.log(\"New board position:\", gameCopy.fen());\n\n        // Update the game state and ref\n        setGame(gameCopy);\n        gameRef.current = gameCopy;\n        setMoveHistory(prev => [...prev, result.san]);\n        if (gameCopy.isGameOver()) {\n          handleGameOver(gameCopy);\n        }\n      } catch (moveError) {\n        console.error(\"Error applying AI move:\", moveError);\n      }\n    } catch (error) {\n      console.error(\"Error during AI move:\", error);\n    } finally {\n      setIsAIThinking(false);\n    }\n  }, [isAIThinking]);\n\n  // Check if move is a pawn promotion\n  function isPawnPromotion(sourceSquare, targetSquare) {\n    const piece = gameRef.current.get(sourceSquare);\n    if (!piece || piece.type !== 'p') return false;\n    const rank = targetSquare.charAt(1);\n    return piece.color === 'w' && rank === '8' || piece.color === 'b' && rank === '1';\n  }\n  function makePlayerMove(sourceSquare, targetSquare, promotionPiece) {\n    console.log(\"Attempting player move from\", sourceSquare, \"to\", targetSquare, promotionPiece ? `with promotion to ${promotionPiece}` : '');\n    const gameCopy = new Chess(gameRef.current.fen());\n\n    // Check if this is a pawn promotion without a promotion piece specified\n    if (isPawnPromotion(sourceSquare, targetSquare) && !promotionPiece) {\n      console.log(\"Pawn promotion detected, showing promotion UI\");\n      setPendingPromotion({\n        from: sourceSquare,\n        to: targetSquare\n      });\n      setPromotionVisible(true);\n      return false;\n    }\n    try {\n      const moveObj = {\n        from: sourceSquare,\n        to: targetSquare,\n        promotion: promotionPiece // Will be undefined if not a promotion\n      };\n      console.log(\"Move being applied:\", moveObj);\n      const result = gameCopy.move(moveObj);\n      if (!result) {\n        console.error(\"Failed to apply move:\", moveObj);\n        return false;\n      }\n      console.log(\"Player move successfully applied:\", result);\n      console.log(\"New board position:\", gameCopy.fen());\n\n      // Update both state and ref\n      setGame(gameCopy);\n      gameRef.current = gameCopy;\n      setMoveHistory(prev => [...prev, result.san]);\n      if (gameCopy.isGameOver()) {\n        handleGameOver(gameCopy);\n        return true;\n      }\n\n      // Now make the AI move\n      setTimeout(() => {\n        makeAIMove();\n      }, 300);\n      return true;\n    } catch (error) {\n      console.error(\"Error making player move:\", error);\n      return false;\n    }\n  }\n  function handlePromotion(promotionPiece) {\n    if (!pendingPromotion) return;\n    console.log(`Promoting to ${promotionPiece}`);\n    const moveSuccess = makePlayerMove(pendingPromotion.from, pendingPromotion.to, promotionPiece);\n    setPromotionVisible(false);\n    setPendingPromotion(null);\n    return moveSuccess;\n  }\n  function onDrop(sourceSquare, targetSquare) {\n    const currentTurn = gameRef.current.turn() === 'w' ? 'white' : 'black';\n    if (currentTurn !== playerColor) {\n      console.log(\"Not your turn!\");\n      return false;\n    }\n    console.log(\"User attempting move from\", sourceSquare, \"to\", targetSquare);\n    const legalMoves = showLegalMoves(sourceSquare);\n    const isLegalTarget = legalMoves.some(move => move.to === targetSquare);\n    if (!isLegalTarget) {\n      console.error(`${targetSquare} is not a legal target from ${sourceSquare}`);\n      return false;\n    }\n    return makePlayerMove(sourceSquare, targetSquare);\n  }\n\n  // Check if it's AI's turn when the component mounts or game state changes\n  useEffect(() => {\n    if (!isAIThinking && !promotionVisible) {\n      const timeoutId = setTimeout(() => {\n        const currentTurn = gameRef.current.turn() === 'w' ? 'white' : 'black';\n        if (currentTurn !== playerColor && !gameRef.current.isGameOver()) {\n          makeAIMove();\n        }\n      }, 500);\n      return () => clearTimeout(timeoutId);\n    }\n  }, [game, playerColor, isAIThinking, makeAIMove, promotionVisible]);\n  function handleGameOver(currentGame) {\n    const gameToUse = currentGame || game;\n    let result = 'draw';\n    if (gameToUse.isCheckmate()) {\n      result = gameToUse.turn() === 'w' ? 'black' : 'white';\n    }\n    console.log(\"Game over! Result:\", result);\n    saveGameData(result, gameToUse);\n    if (onGameEnd) {\n      onGameEnd({\n        result,\n        pgn: gameToUse.pgn(),\n        history: moveHistory\n      });\n    }\n  }\n  async function saveGameData(result, currentGame) {\n    try {\n      await fetch('http://localhost:8000/chess/save-game', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          pgn: currentGame.pgn(),\n          result: result\n        })\n      });\n    } catch (error) {\n      console.error('Error saving game:', error);\n    }\n  }\n  function resetGame() {\n    const newGame = new Chess();\n    setGame(newGame);\n    gameRef.current = newGame;\n    setMoveHistory([]);\n    setSelectedSquare(null);\n    setLegalMoveSquares({});\n    setPendingPromotion(null);\n    setPromotionVisible(false);\n    if (playerColor === 'black') {\n      setTimeout(makeAIMove, 500);\n    }\n  }\n  function flipBoard() {\n    const newOrientation = boardOrientation === 'white' ? 'black' : 'white';\n    setBoardOrientation(newOrientation);\n    setPlayerColor(newOrientation);\n    const newGame = new Chess();\n    setGame(newGame);\n    gameRef.current = newGame;\n    setMoveHistory([]);\n    setSelectedSquare(null);\n    setLegalMoveSquares({});\n    setPendingPromotion(null);\n    setPromotionVisible(false);\n    if (newOrientation === 'black') {\n      setTimeout(makeAIMove, 500);\n    }\n  }\n  function onSquareClick(square) {\n    console.log(\"Square clicked:\", square);\n\n    // If promotion UI is visible, ignore square clicks\n    if (promotionVisible) return;\n    const currentTurn = gameRef.current.turn() === 'w' ? 'white' : 'black';\n    if (currentTurn !== playerColor) {\n      console.log(\"Not your turn!\");\n      return;\n    }\n    if (!selectedSquare) {\n      const piece = gameRef.current.get(square);\n      if (piece) {\n        const pieceColor = piece.color === 'w' ? 'white' : 'black';\n        if (pieceColor === playerColor) {\n          setSelectedSquare(square);\n          const legalMoves = showLegalMoves(square);\n          const legalSquares = {};\n          legalMoves.forEach(move => {\n            legalSquares[move.to] = {\n              background: 'radial-gradient(circle, rgba(0,0,0,.1) 25%, transparent 25%)',\n              borderRadius: '50%'\n            };\n          });\n          setLegalMoveSquares(legalSquares);\n        }\n      }\n      return;\n    }\n    if (selectedSquare) {\n      if (selectedSquare === square) {\n        setSelectedSquare(null);\n        setLegalMoveSquares({});\n        return;\n      }\n      const legalMoves = showLegalMoves(selectedSquare);\n      const isLegalTarget = legalMoves.some(move => move.to === square);\n      if (!isLegalTarget) {\n        const piece = gameRef.current.get(square);\n        if (piece) {\n          const pieceColor = piece.color === 'w' ? 'white' : 'black';\n          if (pieceColor === playerColor) {\n            setSelectedSquare(square);\n            const newLegalMoves = showLegalMoves(square);\n            const newLegalSquares = {};\n            newLegalMoves.forEach(move => {\n              newLegalSquares[move.to] = {\n                background: 'radial-gradient(circle, rgba(0,0,0,.1) 25%, transparent 25%)',\n                borderRadius: '50%'\n              };\n            });\n            setLegalMoveSquares(newLegalSquares);\n            return;\n          }\n        }\n        setSelectedSquare(null);\n        setLegalMoveSquares({});\n        return false;\n      }\n      const result = makePlayerMove(selectedSquare, square);\n      setSelectedSquare(null);\n      setLegalMoveSquares({});\n      return result;\n    }\n  }\n  function isDraggablePiece({\n    piece,\n    sourceSquare\n  }) {\n    // If promotion UI is visible, nothing should be draggable\n    if (promotionVisible) return false;\n    const pieceColor = piece.charAt(0).toLowerCase() === 'w' ? 'white' : 'black';\n    const currentTurn = gameRef.current.turn() === 'w' ? 'white' : 'black';\n    return currentTurn === playerColor && pieceColor === playerColor;\n  }\n  function getCustomSquareStyles() {\n    const combinedStyles = {\n      ...legalMoveSquares\n    };\n    if (selectedSquare) {\n      combinedStyles[selectedSquare] = {\n        backgroundColor: 'rgba(255, 255, 0, 0.4)'\n      };\n    }\n    return combinedStyles;\n  }\n\n  // Render the promotion UI\n  const PromotionUI = () => {\n    if (!pendingPromotion || !promotionVisible) return null;\n    const pieceColor = gameRef.current.turn() === 'w' ? 'w' : 'b';\n    const promotionPieces = ['q', 'r', 'n', 'b']; // Queen, Rook, Knight, Bishop\n\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"promotion-ui\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"promotion-overlay\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 413,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"promotion-selection\",\n        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n          children: \"Select Promotion\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 415,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"promotion-pieces\",\n          children: promotionPieces.map(piece => /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"promotion-piece\",\n            onClick: () => handlePromotion(piece),\n            children: /*#__PURE__*/_jsxDEV(\"img\", {\n              src: `/pieces/${pieceColor}${piece.toUpperCase()}.png`,\n              alt: `${pieceColor === 'w' ? 'White' : 'Black'} ${piece}`\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 423,\n              columnNumber: 17\n            }, this)\n          }, piece, false, {\n            fileName: _jsxFileName,\n            lineNumber: 418,\n            columnNumber: 15\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 416,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 414,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 412,\n      columnNumber: 7\n    }, this);\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"chessboard-container\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"board\",\n      children: /*#__PURE__*/_jsxDEV(Chessboard, {\n        position: game.fen(),\n        onPieceDrop: onDrop,\n        boardOrientation: boardOrientation,\n        customBoardStyle: {\n          borderRadius: '5px',\n          boxShadow: '0 5px 15px rgba(0, 0, 0, 0.5)'\n        },\n        arePiecesDraggable: true,\n        animationDuration: 200,\n        isDraggablePiece: isDraggablePiece,\n        onSquareClick: onSquareClick,\n        customSquareStyles: getCustomSquareStyles()\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 438,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 437,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"controls\",\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: resetGame,\n        children: \"New Game\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 455,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: flipBoard,\n        children: [\"Play as \", boardOrientation === 'white' ? 'Black' : 'White']\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 456,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 454,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"game-info\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"player-info\",\n        children: [\"Playing as: \", /*#__PURE__*/_jsxDEV(\"strong\", {\n          children: playerColor\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 461,\n          columnNumber: 23\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 460,\n        columnNumber: 9\n      }, this), isAIThinking && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"status\",\n        children: \"AI is thinking...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 463,\n        columnNumber: 26\n      }, this), game.isGameOver() && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"game-over\",\n        children: game.isCheckmate() ? `Checkmate! ${game.turn() === 'w' ? 'Black' : 'White'} wins!` : 'Game ended in a draw'\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 466,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 459,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 436,\n    columnNumber: 5\n  }, this);\n};\n_s(ChessBoard, \"cOGLLxEM171Fyc2PEndbew/btHM=\");\n_c = ChessBoard;\nexport default ChessBoard;\nvar _c;\n$RefreshReg$(_c, \"ChessBoard\");","map":{"version":3,"names":["React","useState","useEffect","useCallback","useRef","Chessboard","Chess","jsxDEV","_jsxDEV","ChessBoard","onGameEnd","_s","game","setGame","boardOrientation","setBoardOrientation","isAIThinking","setIsAIThinking","moveHistory","setMoveHistory","playerColor","setPlayerColor","selectedSquare","setSelectedSquare","legalMoveSquares","setLegalMoveSquares","pendingPromotion","setPendingPromotion","promotionVisible","setPromotionVisible","gameRef","current","fen","showLegalMoves","sourceSquare","legalMoves","moves","square","verbose","console","log","makeAIMove","currentFEN","response","fetch","method","headers","body","JSON","stringify","ok","errorText","text","Error","status","data","json","move","from","to","gameCopy","moveObj","promotion","result","prev","san","isGameOver","handleGameOver","moveError","error","isPawnPromotion","targetSquare","piece","get","type","rank","charAt","color","makePlayerMove","promotionPiece","setTimeout","handlePromotion","moveSuccess","onDrop","currentTurn","turn","isLegalTarget","some","timeoutId","clearTimeout","currentGame","gameToUse","isCheckmate","saveGameData","pgn","history","resetGame","newGame","flipBoard","newOrientation","onSquareClick","pieceColor","legalSquares","forEach","background","borderRadius","newLegalMoves","newLegalSquares","isDraggablePiece","toLowerCase","getCustomSquareStyles","combinedStyles","backgroundColor","PromotionUI","promotionPieces","className","children","fileName","_jsxFileName","lineNumber","columnNumber","map","onClick","src","toUpperCase","alt","position","onPieceDrop","customBoardStyle","boxShadow","arePiecesDraggable","animationDuration","customSquareStyles","_c","$RefreshReg$"],"sources":["/Users/bignola/Desktop/School/Capstone/AI-Chess-main/chess-ai-frontend/src/components/ChessBoard/ChessBoard.jsx"],"sourcesContent":["import React, { useState, useEffect, useCallback, useRef } from 'react';\nimport { Chessboard } from 'react-chessboard';\nimport { Chess } from 'chess.js';\nimport './ChessBoard.css';\n\nconst ChessBoard = ({ onGameEnd }) => {\n  const [game, setGame] = useState(() => new Chess());\n  const [boardOrientation, setBoardOrientation] = useState('white');\n  const [isAIThinking, setIsAIThinking] = useState(false);\n  const [moveHistory, setMoveHistory] = useState([]);\n  const [playerColor, setPlayerColor] = useState('white');\n  const [selectedSquare, setSelectedSquare] = useState(null);\n  const [legalMoveSquares, setLegalMoveSquares] = useState({});\n  // Add states for promotion handling\n  const [pendingPromotion, setPendingPromotion] = useState(null);\n  const [promotionVisible, setPromotionVisible] = useState(false);\n  // Use a ref to track the current game state for async operations\n  const gameRef = useRef(new Chess());\n\n  // Update the ref whenever game state changes\n  useEffect(() => {\n    gameRef.current = new Chess(game.fen());\n  }, [game]);\n\n  function showLegalMoves(sourceSquare) {\n    if (!sourceSquare) return [];\n    \n    const legalMoves = game.moves({\n      square: sourceSquare,\n      verbose: true\n    });\n    \n    console.log(`Legal moves from ${sourceSquare}:`, legalMoves);\n    return legalMoves;\n  }\n\n  // Make AI move - wrapped in useCallback to fix dependency warning\n  const makeAIMove = useCallback(async () => {\n    if (isAIThinking) {\n      console.log(\"AI is already thinking, skipping move request\");\n      return;\n    }\n\n    setIsAIThinking(true);\n    console.log(\"AI is thinking...\");\n    \n    try {\n      // Use the gameRef to get the current state\n      const currentFEN = gameRef.current.fen();\n      console.log(\"Current FEN for AI move:\", currentFEN);\n\n      const response = await fetch('http://localhost:8000/chess/get-move', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({ fen: currentFEN }),\n      });\n\n      if (!response.ok) {\n        const errorText = await response.text();\n        throw new Error(`Server responded with ${response.status}: ${errorText}`);\n      }\n\n      const data = await response.json();\n      console.log(\"AI selected move:\", data.move);\n      \n      if (!data.move || !data.move.from || !data.move.to) {\n        throw new Error(\"Invalid move data received from AI: \" + JSON.stringify(data));\n      }\n      \n      // Use the gameRef to make the AI move\n      const gameCopy = new Chess(currentFEN);\n      \n      try {\n        const moveObj = {\n          from: data.move.from,\n          to: data.move.to,\n          promotion: data.move.promotion || 'q' // Default to queen if not specified\n        };\n        \n        console.log(\"AI move being applied:\", moveObj);\n        const result = gameCopy.move(moveObj);\n        \n        if (!result) {\n          throw new Error(\"Failed to apply AI move: \" + JSON.stringify(moveObj));\n        }\n        \n        console.log(\"AI move successfully applied:\", result);\n        console.log(\"New board position:\", gameCopy.fen());\n        \n        // Update the game state and ref\n        setGame(gameCopy);\n        gameRef.current = gameCopy;\n        \n        setMoveHistory(prev => [...prev, result.san]);\n        \n        if (gameCopy.isGameOver()) {\n          handleGameOver(gameCopy);\n        }\n      } catch (moveError) {\n        console.error(\"Error applying AI move:\", moveError);\n      }\n    } catch (error) {\n      console.error(\"Error during AI move:\", error);\n    } finally {\n      setIsAIThinking(false);\n    }\n  }, [isAIThinking]);\n\n  // Check if move is a pawn promotion\n  function isPawnPromotion(sourceSquare, targetSquare) {\n    const piece = gameRef.current.get(sourceSquare);\n    if (!piece || piece.type !== 'p') return false;\n    \n    const rank = targetSquare.charAt(1);\n    return (piece.color === 'w' && rank === '8') || (piece.color === 'b' && rank === '1');\n  }\n\n  function makePlayerMove(sourceSquare, targetSquare, promotionPiece) {\n    console.log(\"Attempting player move from\", sourceSquare, \"to\", targetSquare, \n                promotionPiece ? `with promotion to ${promotionPiece}` : '');\n    \n    const gameCopy = new Chess(gameRef.current.fen());\n    \n    // Check if this is a pawn promotion without a promotion piece specified\n    if (isPawnPromotion(sourceSquare, targetSquare) && !promotionPiece) {\n      console.log(\"Pawn promotion detected, showing promotion UI\");\n      setPendingPromotion({\n        from: sourceSquare,\n        to: targetSquare\n      });\n      setPromotionVisible(true);\n      return false;\n    }\n    \n    try {\n      const moveObj = {\n        from: sourceSquare,\n        to: targetSquare,\n        promotion: promotionPiece // Will be undefined if not a promotion\n      };\n      \n      console.log(\"Move being applied:\", moveObj);\n      \n      const result = gameCopy.move(moveObj);\n      \n      if (!result) {\n        console.error(\"Failed to apply move:\", moveObj);\n        return false;\n      }\n      \n      console.log(\"Player move successfully applied:\", result);\n      console.log(\"New board position:\", gameCopy.fen());\n      \n      // Update both state and ref\n      setGame(gameCopy);\n      gameRef.current = gameCopy;\n      \n      setMoveHistory(prev => [...prev, result.san]);\n      \n      if (gameCopy.isGameOver()) {\n        handleGameOver(gameCopy);\n        return true;\n      }\n      \n      // Now make the AI move\n      setTimeout(() => {\n        makeAIMove();\n      }, 300);\n      \n      return true;\n    } catch (error) {\n      console.error(\"Error making player move:\", error);\n      return false;\n    }\n  }\n\n  function handlePromotion(promotionPiece) {\n    if (!pendingPromotion) return;\n    \n    console.log(`Promoting to ${promotionPiece}`);\n    \n    const moveSuccess = makePlayerMove(\n      pendingPromotion.from,\n      pendingPromotion.to,\n      promotionPiece\n    );\n    \n    setPromotionVisible(false);\n    setPendingPromotion(null);\n    \n    return moveSuccess;\n  }\n\n  function onDrop(sourceSquare, targetSquare) {\n    const currentTurn = gameRef.current.turn() === 'w' ? 'white' : 'black';\n    if (currentTurn !== playerColor) {\n      console.log(\"Not your turn!\");\n      return false;\n    }\n\n    console.log(\"User attempting move from\", sourceSquare, \"to\", targetSquare);\n    \n    const legalMoves = showLegalMoves(sourceSquare);\n    const isLegalTarget = legalMoves.some(move => move.to === targetSquare);\n    \n    if (!isLegalTarget) {\n      console.error(`${targetSquare} is not a legal target from ${sourceSquare}`);\n      return false;\n    }\n    \n    return makePlayerMove(sourceSquare, targetSquare);\n  }\n\n  // Check if it's AI's turn when the component mounts or game state changes\n  useEffect(() => {\n    if (!isAIThinking && !promotionVisible) {\n      const timeoutId = setTimeout(() => {\n        const currentTurn = gameRef.current.turn() === 'w' ? 'white' : 'black';\n        \n        if (currentTurn !== playerColor && !gameRef.current.isGameOver()) {\n          makeAIMove();\n        }\n      }, 500);\n      \n      return () => clearTimeout(timeoutId);\n    }\n  }, [game, playerColor, isAIThinking, makeAIMove, promotionVisible]);\n\n  function handleGameOver(currentGame) {\n    const gameToUse = currentGame || game;\n    let result = 'draw';\n    if (gameToUse.isCheckmate()) {\n      result = gameToUse.turn() === 'w' ? 'black' : 'white';\n    }\n\n    console.log(\"Game over! Result:\", result);\n    saveGameData(result, gameToUse);\n    \n    if (onGameEnd) {\n      onGameEnd({\n        result,\n        pgn: gameToUse.pgn(),\n        history: moveHistory,\n      });\n    }\n  }\n\n  async function saveGameData(result, currentGame) {\n    try {\n      await fetch('http://localhost:8000/chess/save-game', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          pgn: currentGame.pgn(),\n          result: result,\n        }),\n      });\n    } catch (error) {\n      console.error('Error saving game:', error);\n    }\n  }\n\n  function resetGame() {\n    const newGame = new Chess();\n    setGame(newGame);\n    gameRef.current = newGame;\n    setMoveHistory([]);\n    setSelectedSquare(null);\n    setLegalMoveSquares({});\n    setPendingPromotion(null);\n    setPromotionVisible(false);\n    \n    if (playerColor === 'black') {\n      setTimeout(makeAIMove, 500);\n    }\n  }\n\n  function flipBoard() {\n    const newOrientation = boardOrientation === 'white' ? 'black' : 'white';\n    setBoardOrientation(newOrientation);\n    setPlayerColor(newOrientation);\n    \n    const newGame = new Chess();\n    setGame(newGame);\n    gameRef.current = newGame;\n    setMoveHistory([]);\n    setSelectedSquare(null);\n    setLegalMoveSquares({});\n    setPendingPromotion(null);\n    setPromotionVisible(false);\n    \n    if (newOrientation === 'black') {\n      setTimeout(makeAIMove, 500);\n    }\n  }\n\n  function onSquareClick(square) {\n    console.log(\"Square clicked:\", square);\n    \n    // If promotion UI is visible, ignore square clicks\n    if (promotionVisible) return;\n    \n    const currentTurn = gameRef.current.turn() === 'w' ? 'white' : 'black';\n    if (currentTurn !== playerColor) {\n      console.log(\"Not your turn!\");\n      return;\n    }\n    \n    if (!selectedSquare) {\n      const piece = gameRef.current.get(square);\n      if (piece) {\n        const pieceColor = piece.color === 'w' ? 'white' : 'black';\n        \n        if (pieceColor === playerColor) {\n          setSelectedSquare(square);\n          \n          const legalMoves = showLegalMoves(square);\n          \n          const legalSquares = {};\n          legalMoves.forEach(move => {\n            legalSquares[move.to] = {\n              background: 'radial-gradient(circle, rgba(0,0,0,.1) 25%, transparent 25%)',\n              borderRadius: '50%'\n            };\n          });\n          \n          setLegalMoveSquares(legalSquares);\n        }\n      }\n      return;\n    }\n    \n    if (selectedSquare) {\n      if (selectedSquare === square) {\n        setSelectedSquare(null);\n        setLegalMoveSquares({});\n        return;\n      }\n      \n      const legalMoves = showLegalMoves(selectedSquare);\n      const isLegalTarget = legalMoves.some(move => move.to === square);\n      \n      if (!isLegalTarget) {\n        const piece = gameRef.current.get(square);\n        if (piece) {\n          const pieceColor = piece.color === 'w' ? 'white' : 'black';\n          if (pieceColor === playerColor) {\n            setSelectedSquare(square);\n            \n            const newLegalMoves = showLegalMoves(square);\n            const newLegalSquares = {};\n            newLegalMoves.forEach(move => {\n              newLegalSquares[move.to] = {\n                background: 'radial-gradient(circle, rgba(0,0,0,.1) 25%, transparent 25%)',\n                borderRadius: '50%'\n              };\n            });\n            \n            setLegalMoveSquares(newLegalSquares);\n            return;\n          }\n        }\n        \n        setSelectedSquare(null);\n        setLegalMoveSquares({});\n        return false;\n      }\n      \n      const result = makePlayerMove(selectedSquare, square);\n      \n      setSelectedSquare(null);\n      setLegalMoveSquares({});\n      \n      return result;\n    }\n  }\n\n  function isDraggablePiece({ piece, sourceSquare }) {\n    // If promotion UI is visible, nothing should be draggable\n    if (promotionVisible) return false;\n    \n    const pieceColor = piece.charAt(0).toLowerCase() === 'w' ? 'white' : 'black';\n    const currentTurn = gameRef.current.turn() === 'w' ? 'white' : 'black';\n    \n    return currentTurn === playerColor && pieceColor === playerColor;\n  }\n\n  function getCustomSquareStyles() {\n    const combinedStyles = { ...legalMoveSquares };\n    \n    if (selectedSquare) {\n      combinedStyles[selectedSquare] = {\n        backgroundColor: 'rgba(255, 255, 0, 0.4)',\n      };\n    }\n    \n    return combinedStyles;\n  }\n\n  // Render the promotion UI\n  const PromotionUI = () => {\n    if (!pendingPromotion || !promotionVisible) return null;\n    \n    const pieceColor = gameRef.current.turn() === 'w' ? 'w' : 'b';\n    const promotionPieces = ['q', 'r', 'n', 'b']; // Queen, Rook, Knight, Bishop\n    \n    return (\n      <div className=\"promotion-ui\">\n        <div className=\"promotion-overlay\"></div>\n        <div className=\"promotion-selection\">\n          <h3>Select Promotion</h3>\n          <div className=\"promotion-pieces\">\n            {promotionPieces.map((piece) => (\n              <div \n                key={piece} \n                className=\"promotion-piece\" \n                onClick={() => handlePromotion(piece)}\n              >\n                <img\n                  src={`/pieces/${pieceColor}${piece.toUpperCase()}.png`}\n                  alt={`${pieceColor === 'w' ? 'White' : 'Black'} ${piece}`}\n                />\n              </div>\n            ))}\n          </div>\n        </div>\n      </div>\n    );\n  };\n\n  return (\n    <div className=\"chessboard-container\">\n      <div className=\"board\">\n        <Chessboard \n          position={game.fen()} \n          onPieceDrop={onDrop} \n          boardOrientation={boardOrientation}\n          customBoardStyle={{\n            borderRadius: '5px',\n            boxShadow: '0 5px 15px rgba(0, 0, 0, 0.5)'\n          }}\n          arePiecesDraggable={true}\n          animationDuration={200}\n          isDraggablePiece={isDraggablePiece}\n          onSquareClick={onSquareClick}\n          customSquareStyles={getCustomSquareStyles()}\n        />\n      </div>\n      \n      <div className=\"controls\">\n        <button onClick={resetGame}>New Game</button>\n        <button onClick={flipBoard}>Play as {boardOrientation === 'white' ? 'Black' : 'White'}</button>\n      </div>\n      \n      <div className=\"game-info\">\n        <div className=\"player-info\">\n          Playing as: <strong>{playerColor}</strong>\n        </div>\n        {isAIThinking && <div className=\"status\">AI is thinking...</div>}\n        \n        {game.isGameOver() && (\n          <div className=\"game-over\">\n            {game.isCheckmate() \n              ? `Checkmate! ${game.turn() === 'w' ? 'Black' : 'White'} wins!` \n              : 'Game ended in a draw'}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default ChessBoard;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}